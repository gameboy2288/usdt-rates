# Сервис Курсов USDT

Данный проект представляет собой gRPC-сервис для получения и сохранения курсов USDT (ask и bid цены) с биржи Garantex. Сервис написан на Go и включает мониторинг, трассировку и логирование, а также интеграцию с PostgreSQL для хранения данных.

---

## Основной функционал

- **gRPC API**:
  - `GetRates`: Получение ask и bid цен USDT с биржи Garantex и сохранение их в базе данных PostgreSQL вместе с меткой времени.
  - `HealthCheck`: Проверка статуса работоспособности сервиса.

- **Корректное завершение работы**: Обработка сигналов завершения для корректного освобождения ресурсов.

- **Поддержка базы данных**:
  - Интеграция с PostgreSQL для хранения курсов.
  - Использование миграций для управления схемой базы данных.

- **Наблюдаемость**:
  - Трассировка запросов с помощью OpenTelemetry.
  - Мониторинг метрик с помощью Prometheus.
  - Структурированное логирование с использованием Zap.

- **Конфигурирование**:
  - Настройки через переменные окружения и флаги командной строки.

---

## Предварительные требования

- Go версии 1.22 или выше
- Docker и Docker Compose
- PostgreSQL
- Утилита make

---

## Установка

### 1. Клонирование репозитория

git clone <url-репозитория>
cd <папка-репозитория>

### 2. Сборка приложения

make build

### 3. Запуск через Docker Compose

docker-compose up -d

### 4. Запуск сервиса

docker-compose run --rm app ./app

---

## Использование

### Методы gRPC

#### GetRates
Получает ask и bid цены USDT с биржи Garantex, а также метку времени, и сохраняет эти данные в базу данных.

#### HealthCheck
Проверяет статус работоспособности сервиса.

---

## Конфигурация

Приложение поддерживает настройку через переменные окружения и флаги командной строки.

### Переменные окружения

POSTGRES_HOST       - Хост PostgreSQL (по умолчанию: localhost)  
POSTGRES_PORT       - Порт PostgreSQL (по умолчанию: 5432)  
POSTGRES_USER       - Пользователь PostgreSQL (по умолчанию: postgres)  
POSTGRES_PASSWORD   - Пароль PostgreSQL (по умолчанию: password)  
POSTGRES_DB         - Имя базы данных PostgreSQL (по умолчанию: usdt_rates)  
GRPC_PORT           - Порт gRPC-сервера (по умолчанию: 50051)  

---

## Команды Makefile

make build — Сборка приложения  
make test — Запуск unit-тестов  
make docker-build — Сборка Docker-образа  
make run — Запуск приложения  
make lint — Запуск линтера GolangCI-Lint  

---

## Мониторинг и трассировка

- **Трассировка**: Запросы трассируются с помощью OpenTelemetry.
- **Метрики**: Для сбора метрик используется Prometheus.

Эндпоинт для метрик Prometheus доступен по адресу http://localhost:9090 (по умолчанию).

---

## Запуск тестов

Запуск unit-тестов выполняется с помощью команды:

make test

---

## Миграции базы данных

Для создания и обновления схемы базы данных используются миграции. Чтобы применить миграции, выполните команду:

<команда-для-миграции>

---

## Пример рабочего процесса

1. Клонирование репозитория:
   git clone <url-репозитория>  
   cd <папка-репозитория>

2. Сборка и запуск приложения:
   make build  
   docker-compose up -d

3. Запуск тестов:
   make test

4. Подключение к gRPC-серверу на порту 50051.

---

## Мониторинг и логирование

- **Zap**: Логирование ключевых событий приложения.
- **Prometheus**: Сбор метрик для мониторинга.
- **OpenTelemetry**: Трассировка запросов для анализа и отладки.

---

## Зависимости

- [GolangCI-Lint](https://golangci-lint.run/)  
- [Zap Logging](https://github.com/uber-go/zap)  
- [Prometheus](https://prometheus.io/)  
- [OpenTelemetry](https://opentelemetry.io/)  

---

## Лицензия

Проект лицензирован под MIT License. Подробнее см. в файле LICENSE.

---
